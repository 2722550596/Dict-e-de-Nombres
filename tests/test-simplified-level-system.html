<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简化等级系统测试</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: #f8fafc;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
        
        .test-result.pass {
            background: #c6f6d5;
            border-left: 4px solid #38a169;
        }
        
        .test-result.fail {
            background: #fed7d7;
            border-left: 4px solid #e53e3e;
        }
        
        .test-result.info {
            background: #bee3f8;
            border-left: 4px solid #3182ce;
        }
        
        button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #3182ce;
        }
        
        .level-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .level-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .level-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4299e1;
        }
        
        .level-exp {
            font-size: 0.9rem;
            color: #64748b;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 简化等级系统测试</h1>
        
        <div class="test-section">
            <h2>📊 等级计算测试</h2>
            <button onclick="runLevelTests()">运行等级测试</button>
            <div id="level-test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>📈 经验进度测试</h2>
            <button onclick="runProgressTests()">运行进度测试</button>
            <div id="progress-test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>🎯 等级曲线展示</h2>
            <button onclick="showLevelCurve()">显示等级曲线</button>
            <div id="level-curve-results"></div>
        </div>
    </div>

    <script>
        // 简化的等级系统 - 直接复制gameData.ts中的逻辑
        class SimplifiedLevelSystem {
            // 计算等级 - 分段式指数增长系统
            static calculateLevel(experience) {
                const safeExperience = Math.max(0, experience);
                
                if (safeExperience === 0) return 1;
                
                // 使用二分查找优化性能
                let left = 1;
                let right = 100; // 最大等级
                let result = 1;
                
                while (left <= right) {
                    const mid = Math.floor((left + right) / 2);
                    const requiredExp = this.getExperienceRequiredForLevel(mid);
                    
                    if (requiredExp <= safeExperience) {
                        result = mid;
                        left = mid + 1;
                    } else {
                        right = mid - 1;
                    }
                }
                
                return result;
            }

            // 获取当前等级的经验需求
            static getExperienceRequiredForLevel(level) {
                const safeLevel = Math.max(1, Math.min(level, 100));
                
                if (safeLevel <= 1) return 0;
                
                let totalExp = 0;
                
                // 第一阶段 (2-10级): 快速升级期
                for (let i = 2; i <= Math.min(safeLevel, 10); i++) {
                    const expForLevel = Math.floor(100 * Math.pow(1.4, i - 2));
                    totalExp += expForLevel;
                }
                
                // 第二阶段 (11-30级): 稳定增长期
                if (safeLevel > 10) {
                    for (let i = 11; i <= Math.min(safeLevel, 30); i++) {
                        const additionalLevel = i - 10;
                        const expForLevel = Math.floor(500 * Math.pow(1.3, additionalLevel - 1));
                        totalExp += expForLevel;
                    }
                }
                
                // 第三阶段 (31级+): 挑战期
                if (safeLevel > 30) {
                    for (let i = 31; i <= safeLevel; i++) {
                        const additionalLevel = i - 30;
                        const expForLevel = Math.floor(2000 * Math.pow(1.25, additionalLevel - 1));
                        totalExp += expForLevel;
                    }
                }
                
                return totalExp;
            }

            // 获取下一级所需经验
            static getExperienceForNextLevel(level) {
                const safeLevel = Math.max(1, Math.min(level, 100));
                
                if (safeLevel >= 100) {
                    return 0; // 已达到最高等级
                }
                
                const currentLevelExp = this.getExperienceRequiredForLevel(safeLevel);
                const nextLevelExp = this.getExperienceRequiredForLevel(safeLevel + 1);
                
                return nextLevelExp - currentLevelExp;
            }

            // 获取经验值进度信息
            static getExperienceProgress(experience) {
                const safeExperience = Math.max(0, experience);
                const level = this.calculateLevel(safeExperience);
                
                const currentLevelRequiredExp = this.getExperienceRequiredForLevel(level);
                const nextLevelRequiredExp = this.getExperienceRequiredForLevel(level + 1);
                
                const currentLevelExp = Math.max(0, safeExperience - currentLevelRequiredExp);
                const nextLevelExp = nextLevelRequiredExp - currentLevelRequiredExp;
                
                let progress = 0;
                if (nextLevelExp > 0) {
                    progress = currentLevelExp / nextLevelExp;
                } else {
                    progress = 1; // 已达到最高等级
                }
                
                return {
                    level,
                    currentLevelExp: Math.max(0, currentLevelExp),
                    nextLevelExp: Math.max(0, nextLevelExp),
                    progress: Math.min(1, Math.max(0, progress))
                };
            }
        }
        
        function runLevelTests() {
            const resultsDiv = document.getElementById('level-test-results');
            resultsDiv.innerHTML = '<h3>等级计算测试结果</h3>';
            
            const tests = [
                { name: '0经验应该是1级', exp: 0, expectedLevel: 1 },
                { name: '100经验应该是2级', exp: 100, expectedLevel: 2 },
                { name: '240经验应该是3级', exp: 240, expectedLevel: 3 },
                { name: '1000经验的等级计算', exp: 1000, expectedLevel: null },
                { name: '10000经验的等级计算', exp: 10000, expectedLevel: null },
                { name: '负数经验应该是1级', exp: -100, expectedLevel: 1 }
            ];
            
            let passCount = 0;
            tests.forEach(test => {
                const actualLevel = SimplifiedLevelSystem.calculateLevel(test.exp);
                const passed = test.expectedLevel ? actualLevel === test.expectedLevel : true;
                if (passed) passCount++;
                
                resultsDiv.innerHTML += `
                    <div class="test-result ${passed ? 'pass' : 'fail'}">
                        ${passed ? '✅' : '❌'} ${test.name}<br>
                        经验: ${test.exp}, 等级: ${actualLevel}
                        ${test.expectedLevel ? ` (期望: ${test.expectedLevel})` : ''}
                    </div>
                `;
            });
            
            resultsDiv.innerHTML += `
                <div class="test-result info">
                    <strong>测试总结：</strong> ${passCount}/${tests.length} 个测试通过
                </div>
            `;
        }
        
        function runProgressTests() {
            const resultsDiv = document.getElementById('progress-test-results');
            resultsDiv.innerHTML = '<h3>经验进度测试结果</h3>';
            
            const testExperiences = [0, 50, 100, 150, 500, 1000, 5000, 10000];
            
            testExperiences.forEach(exp => {
                const progress = SimplifiedLevelSystem.getExperienceProgress(exp);
                const isValid = progress.level >= 1 && 
                               progress.currentLevelExp >= 0 && 
                               progress.nextLevelExp >= 0 && 
                               progress.progress >= 0 && 
                               progress.progress <= 1;
                
                resultsDiv.innerHTML += `
                    <div class="test-result ${isValid ? 'pass' : 'fail'}">
                        经验: ${exp.toLocaleString()}<br>
                        等级: ${progress.level}<br>
                        当前等级经验: ${progress.currentLevelExp}/${progress.nextLevelExp}<br>
                        进度: ${Math.round(progress.progress * 100)}%
                    </div>
                `;
            });
        }
        
        function showLevelCurve() {
            const resultsDiv = document.getElementById('level-curve-results');
            resultsDiv.innerHTML = '<h3>等级曲线展示</h3>';
            
            const levels = [1, 2, 3, 5, 10, 15, 20, 25, 30, 35, 40, 50];
            let curveHTML = '<div class="level-comparison">';
            
            levels.forEach(level => {
                const requiredExp = SimplifiedLevelSystem.getExperienceRequiredForLevel(level);
                const nextLevelExp = SimplifiedLevelSystem.getExperienceForNextLevel(level);
                
                let phase = '';
                if (level <= 10) phase = '快速升级期';
                else if (level <= 30) phase = '稳定增长期';
                else phase = '挑战期';
                
                curveHTML += `
                    <div class="level-card">
                        <div class="level-number">等级 ${level}</div>
                        <div class="level-exp">总需求: ${requiredExp.toLocaleString()}</div>
                        <div class="level-exp">升级需求: ${nextLevelExp.toLocaleString()}</div>
                        <div class="level-exp" style="color: #4299e1; font-weight: bold;">${phase}</div>
                    </div>
                `;
            });
            
            curveHTML += '</div>';
            resultsDiv.innerHTML += curveHTML;
            
            // 添加分析
            resultsDiv.innerHTML += `
                <div class="test-result info">
                    <strong>等级曲线分析：</strong><br>
                    • 快速升级期 (1-10级): 相对容易，建立信心<br>
                    • 稳定增长期 (11-30级): 稳定节奏，养成习惯<br>
                    • 挑战期 (31级+): 显著挑战，长期目标
                </div>
            `;
        }
    </script>
</body>
</html>