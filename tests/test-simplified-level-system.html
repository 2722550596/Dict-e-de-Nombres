<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€åŒ–ç­‰çº§ç³»ç»Ÿæµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: #f8fafc;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
        
        .test-result.pass {
            background: #c6f6d5;
            border-left: 4px solid #38a169;
        }
        
        .test-result.fail {
            background: #fed7d7;
            border-left: 4px solid #e53e3e;
        }
        
        .test-result.info {
            background: #bee3f8;
            border-left: 4px solid #3182ce;
        }
        
        button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #3182ce;
        }
        
        .level-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .level-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .level-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4299e1;
        }
        
        .level-exp {
            font-size: 0.9rem;
            color: #64748b;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ç®€åŒ–ç­‰çº§ç³»ç»Ÿæµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š ç­‰çº§è®¡ç®—æµ‹è¯•</h2>
            <button onclick="runLevelTests()">è¿è¡Œç­‰çº§æµ‹è¯•</button>
            <div id="level-test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ˆ ç»éªŒè¿›åº¦æµ‹è¯•</h2>
            <button onclick="runProgressTests()">è¿è¡Œè¿›åº¦æµ‹è¯•</button>
            <div id="progress-test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ¯ ç­‰çº§æ›²çº¿å±•ç¤º</h2>
            <button onclick="showLevelCurve()">æ˜¾ç¤ºç­‰çº§æ›²çº¿</button>
            <div id="level-curve-results"></div>
        </div>
    </div>

    <script>
        // ç®€åŒ–çš„ç­‰çº§ç³»ç»Ÿ - ç›´æ¥å¤åˆ¶gameData.tsä¸­çš„é€»è¾‘
        class SimplifiedLevelSystem {
            // è®¡ç®—ç­‰çº§ - åˆ†æ®µå¼æŒ‡æ•°å¢é•¿ç³»ç»Ÿ
            static calculateLevel(experience) {
                const safeExperience = Math.max(0, experience);
                
                if (safeExperience === 0) return 1;
                
                // ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ä¼˜åŒ–æ€§èƒ½
                let left = 1;
                let right = 100; // æœ€å¤§ç­‰çº§
                let result = 1;
                
                while (left <= right) {
                    const mid = Math.floor((left + right) / 2);
                    const requiredExp = this.getExperienceRequiredForLevel(mid);
                    
                    if (requiredExp <= safeExperience) {
                        result = mid;
                        left = mid + 1;
                    } else {
                        right = mid - 1;
                    }
                }
                
                return result;
            }

            // è·å–å½“å‰ç­‰çº§çš„ç»éªŒéœ€æ±‚
            static getExperienceRequiredForLevel(level) {
                const safeLevel = Math.max(1, Math.min(level, 100));
                
                if (safeLevel <= 1) return 0;
                
                let totalExp = 0;
                
                // ç¬¬ä¸€é˜¶æ®µ (2-10çº§): å¿«é€Ÿå‡çº§æœŸ
                for (let i = 2; i <= Math.min(safeLevel, 10); i++) {
                    const expForLevel = Math.floor(100 * Math.pow(1.4, i - 2));
                    totalExp += expForLevel;
                }
                
                // ç¬¬äºŒé˜¶æ®µ (11-30çº§): ç¨³å®šå¢é•¿æœŸ
                if (safeLevel > 10) {
                    for (let i = 11; i <= Math.min(safeLevel, 30); i++) {
                        const additionalLevel = i - 10;
                        const expForLevel = Math.floor(500 * Math.pow(1.3, additionalLevel - 1));
                        totalExp += expForLevel;
                    }
                }
                
                // ç¬¬ä¸‰é˜¶æ®µ (31çº§+): æŒ‘æˆ˜æœŸ
                if (safeLevel > 30) {
                    for (let i = 31; i <= safeLevel; i++) {
                        const additionalLevel = i - 30;
                        const expForLevel = Math.floor(2000 * Math.pow(1.25, additionalLevel - 1));
                        totalExp += expForLevel;
                    }
                }
                
                return totalExp;
            }

            // è·å–ä¸‹ä¸€çº§æ‰€éœ€ç»éªŒ
            static getExperienceForNextLevel(level) {
                const safeLevel = Math.max(1, Math.min(level, 100));
                
                if (safeLevel >= 100) {
                    return 0; // å·²è¾¾åˆ°æœ€é«˜ç­‰çº§
                }
                
                const currentLevelExp = this.getExperienceRequiredForLevel(safeLevel);
                const nextLevelExp = this.getExperienceRequiredForLevel(safeLevel + 1);
                
                return nextLevelExp - currentLevelExp;
            }

            // è·å–ç»éªŒå€¼è¿›åº¦ä¿¡æ¯
            static getExperienceProgress(experience) {
                const safeExperience = Math.max(0, experience);
                const level = this.calculateLevel(safeExperience);
                
                const currentLevelRequiredExp = this.getExperienceRequiredForLevel(level);
                const nextLevelRequiredExp = this.getExperienceRequiredForLevel(level + 1);
                
                const currentLevelExp = Math.max(0, safeExperience - currentLevelRequiredExp);
                const nextLevelExp = nextLevelRequiredExp - currentLevelRequiredExp;
                
                let progress = 0;
                if (nextLevelExp > 0) {
                    progress = currentLevelExp / nextLevelExp;
                } else {
                    progress = 1; // å·²è¾¾åˆ°æœ€é«˜ç­‰çº§
                }
                
                return {
                    level,
                    currentLevelExp: Math.max(0, currentLevelExp),
                    nextLevelExp: Math.max(0, nextLevelExp),
                    progress: Math.min(1, Math.max(0, progress))
                };
            }
        }
        
        function runLevelTests() {
            const resultsDiv = document.getElementById('level-test-results');
            resultsDiv.innerHTML = '<h3>ç­‰çº§è®¡ç®—æµ‹è¯•ç»“æœ</h3>';
            
            const tests = [
                { name: '0ç»éªŒåº”è¯¥æ˜¯1çº§', exp: 0, expectedLevel: 1 },
                { name: '100ç»éªŒåº”è¯¥æ˜¯2çº§', exp: 100, expectedLevel: 2 },
                { name: '240ç»éªŒåº”è¯¥æ˜¯3çº§', exp: 240, expectedLevel: 3 },
                { name: '1000ç»éªŒçš„ç­‰çº§è®¡ç®—', exp: 1000, expectedLevel: null },
                { name: '10000ç»éªŒçš„ç­‰çº§è®¡ç®—', exp: 10000, expectedLevel: null },
                { name: 'è´Ÿæ•°ç»éªŒåº”è¯¥æ˜¯1çº§', exp: -100, expectedLevel: 1 }
            ];
            
            let passCount = 0;
            tests.forEach(test => {
                const actualLevel = SimplifiedLevelSystem.calculateLevel(test.exp);
                const passed = test.expectedLevel ? actualLevel === test.expectedLevel : true;
                if (passed) passCount++;
                
                resultsDiv.innerHTML += `
                    <div class="test-result ${passed ? 'pass' : 'fail'}">
                        ${passed ? 'âœ…' : 'âŒ'} ${test.name}<br>
                        ç»éªŒ: ${test.exp}, ç­‰çº§: ${actualLevel}
                        ${test.expectedLevel ? ` (æœŸæœ›: ${test.expectedLevel})` : ''}
                    </div>
                `;
            });
            
            resultsDiv.innerHTML += `
                <div class="test-result info">
                    <strong>æµ‹è¯•æ€»ç»“ï¼š</strong> ${passCount}/${tests.length} ä¸ªæµ‹è¯•é€šè¿‡
                </div>
            `;
        }
        
        function runProgressTests() {
            const resultsDiv = document.getElementById('progress-test-results');
            resultsDiv.innerHTML = '<h3>ç»éªŒè¿›åº¦æµ‹è¯•ç»“æœ</h3>';
            
            const testExperiences = [0, 50, 100, 150, 500, 1000, 5000, 10000];
            
            testExperiences.forEach(exp => {
                const progress = SimplifiedLevelSystem.getExperienceProgress(exp);
                const isValid = progress.level >= 1 && 
                               progress.currentLevelExp >= 0 && 
                               progress.nextLevelExp >= 0 && 
                               progress.progress >= 0 && 
                               progress.progress <= 1;
                
                resultsDiv.innerHTML += `
                    <div class="test-result ${isValid ? 'pass' : 'fail'}">
                        ç»éªŒ: ${exp.toLocaleString()}<br>
                        ç­‰çº§: ${progress.level}<br>
                        å½“å‰ç­‰çº§ç»éªŒ: ${progress.currentLevelExp}/${progress.nextLevelExp}<br>
                        è¿›åº¦: ${Math.round(progress.progress * 100)}%
                    </div>
                `;
            });
        }
        
        function showLevelCurve() {
            const resultsDiv = document.getElementById('level-curve-results');
            resultsDiv.innerHTML = '<h3>ç­‰çº§æ›²çº¿å±•ç¤º</h3>';
            
            const levels = [1, 2, 3, 5, 10, 15, 20, 25, 30, 35, 40, 50];
            let curveHTML = '<div class="level-comparison">';
            
            levels.forEach(level => {
                const requiredExp = SimplifiedLevelSystem.getExperienceRequiredForLevel(level);
                const nextLevelExp = SimplifiedLevelSystem.getExperienceForNextLevel(level);
                
                let phase = '';
                if (level <= 10) phase = 'å¿«é€Ÿå‡çº§æœŸ';
                else if (level <= 30) phase = 'ç¨³å®šå¢é•¿æœŸ';
                else phase = 'æŒ‘æˆ˜æœŸ';
                
                curveHTML += `
                    <div class="level-card">
                        <div class="level-number">ç­‰çº§ ${level}</div>
                        <div class="level-exp">æ€»éœ€æ±‚: ${requiredExp.toLocaleString()}</div>
                        <div class="level-exp">å‡çº§éœ€æ±‚: ${nextLevelExp.toLocaleString()}</div>
                        <div class="level-exp" style="color: #4299e1; font-weight: bold;">${phase}</div>
                    </div>
                `;
            });
            
            curveHTML += '</div>';
            resultsDiv.innerHTML += curveHTML;
            
            // æ·»åŠ åˆ†æ
            resultsDiv.innerHTML += `
                <div class="test-result info">
                    <strong>ç­‰çº§æ›²çº¿åˆ†æï¼š</strong><br>
                    â€¢ å¿«é€Ÿå‡çº§æœŸ (1-10çº§): ç›¸å¯¹å®¹æ˜“ï¼Œå»ºç«‹ä¿¡å¿ƒ<br>
                    â€¢ ç¨³å®šå¢é•¿æœŸ (11-30çº§): ç¨³å®šèŠ‚å¥ï¼Œå…»æˆä¹ æƒ¯<br>
                    â€¢ æŒ‘æˆ˜æœŸ (31çº§+): æ˜¾è‘—æŒ‘æˆ˜ï¼Œé•¿æœŸç›®æ ‡
                </div>
            `;
        }
    </script>
</body>
</html>